<div style="width:100%;">
    <canvas id="canvas"></canvas>
 </div>
 <script>

   function sortObj(obj) {
      return Object.keys(obj).sort().reduce(function (result, key) {
         result[key] = obj[key];
         return result;
      }, {});
      }      

    var request = new XMLHttpRequest()
    request.open('GET', '{{ activities_api_url }}', true)
    request.onload = function () {
       var data = JSON.parse(this.response);
       console.log(data);

    var week_labels = [];
    var colors = ['#0048BA','#B284BE','#72A0C1','#C46210','#E52B50	','#9F2B68','#F19CBB','#AB274F','#FDEE00','#568203','#007FFF','#DA1884','#7C0A02','#2E5894','#9C2542','#FFE4C4','#3D2B1F','#967117','#BFFF00','#318CE7'];

    var datasets = [];
    var week_count = 0;
    for (const [key, value] of Object.entries(data)) {

       var label = key.replace('_'," ");
       var words = label.split(" ");
       for (let i = 0; i < words.length; i++) {
          words[i] = words[i][0].toUpperCase() + words[i].substr(1);
       }
       label = words.join(" ");

       var e = {};
       e.label = label;
       e.borderColor = [colors[week_count]]; 
       e.backgroundColor = [colors[week_count]]; 
       e.fill = false;
       e.data = [];

       var ordered = sortObj(value);
       var all_count = 0;

       for (const [week, value2] of Object.entries(ordered)) {
         var already = 0;
         for (i = 0; i < week_labels.length; i++) {
            if(week_labels[i] == week){
               already = 1; 
            }

         }
         if(already == 0){
            week_labels.push(week);
            }          
          e.data.push(value2[key+'_count']);
       }
       datasets.push(e);
       week_count++;
    }            

    var config = {
       type: 'line',
       data: {
          labels: week_labels,
          datasets: datasets
       },
       options: {
          responsive: true,
          title: {
             display: true,
             text: 'Week to Week'
          },
          tooltips: {
             mode: 'index',
             intersect: false,
          },
          hover: {
             mode: 'nearest',
             intersect: true
          },
          scales: {
             xAxes: [{
                display: true,
                scaleLabel: {
                   display: true,
                   labelString: 'Week'
                }
             }],
             yAxes: [{
                display: true,
                scaleLabel: {
                   display: true,
                   labelString: 'Value'
                }
             }]
          }
       }
    };

    window.onload = function() {
       var ctx = document.getElementById('canvas').getContext('2d');
       window.myLine = new Chart(ctx, config);
    };

 }
    request.send();            
 </script>